{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import ProviderEngine from 'web3-provider-engine';\nconst CacheSubprovider = require('web3-provider-engine/dist/es5/subproviders/cache.js');\nconst FixtureSubprovider = require('web3-provider-engine/dist/es5/subproviders/fixture.js');\nconst FilterSubprovider = require('web3-provider-engine/dist/es5/subproviders/filters.js');\nconst HookedWalletSubprovider = require('web3-provider-engine/dist/es5/subproviders/hooked-wallet.js');\nconst NonceSubprovider = require('web3-provider-engine/dist/es5/subproviders/nonce-tracker.js');\nconst SubscriptionsSubprovider = require('web3-provider-engine/dist/es5/subproviders/subscriptions.js');\nimport Penpal from 'penpal';\nimport { networkAdapter } from './networks';\nimport { ISDKConfig, IConnectionMethods, INetwork, IOptions, IWidget, BTCSignTxSDKInput } from './interfaces';\nimport { getTxGas } from './utils/getTxGas';\nimport { Query } from './utils/query';\nimport { onWindowLoad } from './utils/onWindowLoad';\nimport { styles } from './styles';\nimport { validateSecureOrigin } from './utils/secureOrigin';\nimport PocketJSCore from 'pocket-js-core';\n\nconst VERSION = '$$PORTIS_SDK_VERSION$$';\n// Create a .env file to override the default WIDGET_URL when running on\nconst WIDGET_URL = process.env.PORTIS_WIDGET_URL || 'https://widget.portis.io';\nconst STAGING_WIDGET_URL = 'https://widget-staging.portis.io';\nconst SUPPORTED_SCOPES = ['email', 'reputation'];\nconst PORTIS_IFRAME_CLASS = 'por_portis-widget-frame';\nconst PORTIS_CONTAINER_CLASS = 'por_portis-container';\n\nonWindowLoad().then(() => {\n  if (document.getElementsByClassName(PORTIS_IFRAME_CLASS).length) {\n    console.warn(\n      'Portis script was already loaded. This might cause unexpected behavior. If loading with a <script> tag, please make sure that you only load it once.',\n    );\n  }\n});\n\nexport default class Portis {\n  config: ISDKConfig;\n  widgetPromise: Promise<IWidget>;\n  widgetInstance: IWidget;\n  engine: ProviderEngine;\n  provider;\n  private _selectedAddress: string;\n  private _network: string;\n  private _widgetUrl = WIDGET_URL;\n  private _onLoginCallback: (walletAddress: string, email?: string, reputation?: string) => void;\n  private _onLogoutCallback: () => void;\n  private _onActiveWalletChangedCallback: (walletAddress: string) => void;\n  private _onErrorCallback: (error: Error) => void;\n\n  constructor(dappId: string, network: string | INetwork, options: IOptions = {}) {\n    validateSecureOrigin();\n    this._checkIfWidgetAlreadyInitialized();\n    this._validateParams(dappId, network, options);\n    this.config = {\n      dappId,\n      network: networkAdapter(network, options.gasRelay),\n      version: VERSION,\n      scope: options.scope,\n      registerPageByDefault: options.registerPageByDefault,\n    };\n    this.provider = this._initProvider(options);\n  }\n\n  changeNetwork(network: string | INetwork, gasRelay?: boolean) {\n    const newNetwork = networkAdapter(network, gasRelay);\n    this.clearSubprovider(NonceSubprovider);\n    this.clearSubprovider(CacheSubprovider);\n    this.config.network = newNetwork;\n  }\n\n  setDefaultEmail(email: string) {\n    this.config.defaultEmail = email;\n  }\n\n  // async singleton\n  async getWidget() {\n    if (!this.widgetInstance) {\n      if (!this.widgetPromise) {\n        this.widgetPromise = this._initWidget();\n      }\n      this.widgetInstance = await this.widgetPromise;\n    }\n    return this.widgetInstance;\n  }\n\n  // Population by the dev of SDK callbacks that might be invoked by the widget\n\n  onLogin(callback: (walletAddress: string, email?: string, reputation?: string) => void) {\n    this._onLoginCallback = callback;\n  }\n\n  onLogout(callback: () => void) {\n    this._onLogoutCallback = callback;\n  }\n\n  onActiveWalletChanged(callback: (walletAddress: string) => void) {\n    this._onActiveWalletChangedCallback = callback;\n  }\n\n  onError(callback: (error: Error) => void) {\n    this._onErrorCallback = callback;\n  }\n\n  // SDK methods that could be invoked by the user and handled by the widget\n\n  async showPortis() {\n    const widgetCommunication = (await this.getWidget()).communication;\n    return widgetCommunication.showPortis(this.config);\n  }\n\n  async logout() {\n    const widgetCommunication = (await this.getWidget()).communication;\n    return widgetCommunication.logout();\n  }\n\n  async getExtendedPublicKey(path: string = \"m/44'/60'/0'/0/0\", coin: string = 'Ethereum') {\n    const widgetCommunication = (await this.getWidget()).communication;\n    return widgetCommunication.getExtendedPublicKey(path, coin, this.config);\n  }\n\n  async importWallet(mnemonicOrPrivateKey: string) {\n    const widgetCommunication = (await this.getWidget()).communication;\n    return widgetCommunication.importWallet(mnemonicOrPrivateKey, this.config);\n  }\n\n  async isLoggedIn() {\n    const widgetCommunication = (await this.getWidget()).communication;\n    return widgetCommunication.isLoggedIn();\n  }\n\n  async signBitcoinTransaction(params: BTCSignTxSDKInput) {\n    const widgetCommunication = (await this.getWidget()).communication;\n    return widgetCommunication.signBitcoinTransaction(params, this.config);\n  }\n\n  async showBitcoinWallet(path: string = \"m/49'/0'/0'/0/0\") {\n    const widgetCommunication = (await this.getWidget()).communication;\n    return widgetCommunication.showBitcoinWallet(path, this.config);\n  }\n\n  // internal methods\n\n  private _checkIfWidgetAlreadyInitialized() {\n    if (document.getElementsByClassName(PORTIS_CONTAINER_CLASS).length) {\n      console.warn(\n        'An instance of Portis was already initialized. This is probably a mistake. Make sure that you use the same Portis instance throughout your app.',\n      );\n    }\n  }\n\n  private _validateParams(dappId: string, network: string | INetwork, options: IOptions) {\n    if (!dappId) {\n      throw new Error(\"[Portis] 'dappId' is required. Get your dappId here: https://dashboard.portis.io\");\n    }\n\n    if (!network) {\n      throw new Error(\n        \"[Portis] 'network' is required. Read more about it here: https://docs.portis.io/#/configuration?id=network\",\n      );\n    }\n\n    if (options.scope) {\n      if (!Array.isArray(options.scope)) {\n        throw new Error(\n          \"[Portis] 'scope' must be an array. Read more about it here: https://docs.portis.io/#/configuration?id=scope\",\n        );\n      }\n\n      const unknownScope = options.scope.filter(item => SUPPORTED_SCOPES.indexOf(item) < 0);\n      if (unknownScope.length > 0) {\n        throw new Error(\n          \"[Portis] invalid 'scope' parameter. Read more about it here: https://docs.portis.io/#/configuration?id=scope\",\n        );\n      }\n    }\n\n    if (options.registerPageByDefault !== undefined && typeof options.registerPageByDefault !== 'boolean') {\n      throw new Error(\n        \"[Portis] invalid 'registerPageByDefault' parameter, must be a boolean. Read more about it here: https://docs.portis.io/#/configuration?id=registerPageByDefault\",\n      );\n    }\n\n    if (options.staging) {\n      console.warn('Please note: you are using the Portis STAGING environment.');\n      this._widgetUrl = STAGING_WIDGET_URL;\n    }\n  }\n\n  private async _initWidget(): Promise<IWidget> {\n    await onWindowLoad();\n\n    const style = document.createElement('style');\n    style.innerHTML = styles;\n\n    const container = document.createElement('div');\n    container.className = PORTIS_CONTAINER_CLASS;\n\n    const widgetFrame = document.createElement('div');\n    widgetFrame.id = `portis-container-${Date.now()}`;\n    widgetFrame.className = PORTIS_IFRAME_CLASS;\n\n    container.appendChild(widgetFrame);\n    document.body.appendChild(container);\n    document.head.appendChild(style);\n\n    const connection = Penpal.connectToChild<IConnectionMethods>({\n      url: this._widgetUrl,\n      appendTo: document.getElementById(widgetFrame.id)!,\n      methods: {\n        setHeight: this._setHeight.bind(this),\n        getWindowSize: this._getWindowSize.bind(this),\n        onLogin: this._onLogin.bind(this),\n        onLogout: this._onLogout.bind(this),\n        onActiveWalletChanged: this._onActiveWalletChanged.bind(this),\n        onError: this._onError.bind(this),\n      },\n    });\n\n    const communication = await connection.promise;\n    communication.setSdkConfig(this.config);\n    connection.iframe.style.position = 'absolute';\n    connection.iframe.style.height = '100%';\n    connection.iframe.style.width = '100%';\n    connection.iframe.style.border = '0 transparent';\n\n    return { communication, widgetFrame };\n  }\n\n  private _initProvider(options: IOptions) {\n    // don't init the engine twice\n    if (this.engine) {\n      return this.engine;\n    }\n\n    this.engine = new ProviderEngine();\n    const query = new Query(this.engine);\n\n    this.engine.send = (payload, callback) => {\n      // Web3 1.0 beta.38 (and above) calls `send` with method and parameters\n      if (typeof payload === 'string') {\n        return new Promise((resolve, reject) => {\n          this.engine.sendAsync(\n            {\n              jsonrpc: '2.0',\n              id: 42,\n              method: payload,\n              params: callback || [],\n            },\n            (error, response) => {\n              if (error) {\n                reject(error);\n              } else {\n                resolve(response.result);\n              }\n            },\n          );\n        });\n      }\n\n      // Web3 1.0 beta.37 (and below) uses `send` with a callback for async queries\n      if (callback) {\n        this.engine.sendAsync(payload, callback);\n        return;\n      }\n\n      let result: any = null;\n      switch (payload.method) {\n        case 'eth_accounts':\n          result = this._selectedAddress ? [this._selectedAddress] : [];\n          break;\n\n        case 'eth_coinbase':\n          result = this._selectedAddress ? [this._selectedAddress] : [];\n          break;\n\n        case 'net_version':\n          result = this._network;\n          break;\n\n        case 'eth_uninstallFilter':\n          this.engine.sendAsync(payload, _ => _);\n          result = true;\n          break;\n\n        default:\n          var message = `The Portis Web3 object does not support synchronous methods like ${\n            payload.method\n          } without a callback parameter.`;\n          throw new Error(message);\n      }\n\n      return {\n        id: payload.id,\n        jsonrpc: payload.jsonrpc,\n        result: result,\n      };\n    };\n\n    this.engine.addProvider(\n      new FixtureSubprovider({\n        web3_clientVersion: `Portis/v${this.config.version}/javascript`,\n        net_listening: true,\n        eth_hashrate: '0x00',\n        eth_mining: false,\n        eth_syncing: true,\n      }),\n    );\n\n    // cache layer\n    this.engine.addProvider(new CacheSubprovider());\n\n    // subscriptions manager\n    this.engine.addProvider(new SubscriptionsSubprovider());\n\n    // filters\n    this.engine.addProvider(new FilterSubprovider());\n\n    // pending nonce\n    this.engine.addProvider(new NonceSubprovider());\n\n    // set default id when needed\n    this.engine.addProvider({\n      setEngine: _ => _,\n      handleRequest: async (payload, next, end) => {\n        if (!payload.id) {\n          payload.id = 42;\n        }\n        next();\n      },\n    });\n\n    // main web3 functionality - carried out via widget communication\n    this.engine.addProvider(\n      new HookedWalletSubprovider({\n        getAccounts: async cb => {\n          const widgetCommunication = (await this.getWidget()).communication;\n          const { error, result } = await widgetCommunication.getAccounts(this.config);\n          if (!error && result) {\n            this._selectedAddress = result[0];\n          }\n          cb(error, result);\n        },\n        signTransaction: async (txParams, cb) => {\n          const widgetCommunication = (await this.getWidget()).communication;\n          const { error, result } = await widgetCommunication.signTransaction(txParams, this.config);\n          cb(error, result);\n        },\n        signMessage: async (msgParams, cb) => {\n          const widgetCommunication = (await this.getWidget()).communication;\n          const params = Object.assign({}, msgParams, { messageStandard: 'signMessage' });\n          const { error, result } = await widgetCommunication.signMessage(params, this.config);\n          cb(error, result);\n        },\n        signPersonalMessage: async (msgParams, cb) => {\n          const widgetCommunication = (await this.getWidget()).communication;\n          const params = Object.assign({}, msgParams, { messageStandard: 'signPersonalMessage' });\n          const { error, result } = await widgetCommunication.signMessage(params, this.config);\n          cb(error, result);\n        },\n        signTypedMessage: async (msgParams, cb) => {\n          const widgetCommunication = (await this.getWidget()).communication;\n          const params = Object.assign({}, msgParams, { messageStandard: 'signTypedMessage' });\n          const { error, result } = await widgetCommunication.signMessage(params, this.config);\n          cb(error, result);\n        },\n        signTypedMessageV3: async (msgParams, cb) => {\n          const widgetCommunication = (await this.getWidget()).communication;\n          const params = Object.assign({}, msgParams, { messageStandard: 'signTypedMessageV3' });\n          const { error, result } = await widgetCommunication.signMessage(params, this.config);\n          cb(error, result);\n        },\n        estimateGas: async (txParams, cb) => {\n          const gas = await getTxGas(query, txParams);\n          cb(null, gas);\n        },\n        getGasPrice: async cb => {\n          cb(null, '');\n        },\n      }),\n    );\n\n    if (!options.pocketDevId) {\n      this.engine.addProvider({\n        setEngine: _ => _,\n        handleRequest: async (payload, next, end) => {\n          const widgetCommunication = (await this.getWidget()).communication;\n          const { error, result } = await widgetCommunication.relay(payload, this.config);\n          if (payload.method === 'net_version') {\n            this._network = result;\n            this.engine.networkVersion = this._network;\n          }\n          end(error, result);\n        },\n      });\n    } else {\n      const pocket = new PocketJSCore.Pocket({\n        devID: options.pocketDevId,\n        networkName: 'ETH',\n        netIDs: [this.config.network.chainId],\n      });\n      this.engine.addProvider({\n        setEngine: _ => _,\n        handleRequest: async (payload, next, end) => {\n          const response = await pocket.sendRelay(\n            new PocketJSCore.Relay('ETH', this.config.network.chainId, JSON.stringify(payload), pocket.configuration),\n          );\n          let result;\n          let error;\n          if (response instanceof Error || !response) {\n            error = response || new Error('Unknown error');\n            result = null;\n          } else {\n            try {\n              result = JSON.parse(response).result;\n              error = null;\n            } catch (e) {\n              result = null;\n              error = e;\n            }\n          }\n          if (payload.method === 'net_version') {\n            this._network = result;\n            this.engine.networkVersion = this._network;\n          }\n          end(error, result);\n        },\n      });\n    }\n\n    this.engine.enable = () =>\n      new Promise((resolve, reject) => {\n        this.engine.sendAsync({ method: 'eth_accounts' }, (error, response) => {\n          if (error) {\n            reject(error);\n          } else {\n            resolve(response.result);\n          }\n        });\n      });\n\n    this.engine.isConnected = () => {\n      return true;\n    };\n\n    this.engine.isPortis = true;\n\n    this.engine.on('error', error => {\n      if (error && error.message && error.message.includes('PollingBlockTracker')) {\n        console.warn('If you see this warning constantly, there might be an error with your RPC node.');\n      } else {\n        console.error(error);\n      }\n    });\n\n    this.engine.start();\n    return this.engine;\n  }\n\n  private async _setHeight(height: number) {\n    const widgetFrame = (await this.getWidget()).widgetFrame;\n    widgetFrame.style.height = `${height}px`;\n  }\n\n  private _getWindowSize() {\n    const body = document.getElementsByTagName('body')[0];\n    const width = window.innerWidth || document.documentElement.clientWidth || body.clientWidth;\n    const height = window.innerHeight || document.documentElement.clientHeight || body.clientHeight;\n    return { width, height };\n  }\n\n  private _onLogin(walletAddress: string, email?: string, reputation?: string) {\n    if (this._onLoginCallback) {\n      this._onLoginCallback(walletAddress, email, reputation);\n    }\n  }\n\n  private _onLogout() {\n    this._selectedAddress = '';\n    if (this._onLogoutCallback) {\n      this._onLogoutCallback();\n    }\n  }\n\n  private _onActiveWalletChanged(walletAddress: string) {\n    if (this._onActiveWalletChangedCallback) {\n      this._onActiveWalletChangedCallback(walletAddress);\n    }\n  }\n\n  private _onError(error: Error) {\n    if (this._onErrorCallback) {\n      this._onErrorCallback(error);\n    }\n  }\n\n  private clearSubprovider(subproviderType) {\n    const subprovider = this.provider._providers.find(subprovider => subprovider instanceof subproviderType);\n    this.provider.removeProvider(subprovider);\n    this.provider.addProvider(new subproviderType());\n  }\n}\n"]}